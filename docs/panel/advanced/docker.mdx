# Panel in Docker
Pelican provides pre-built Docker images via GitHub Packages. `ghcr.io/pelican-dev/panel:latest` is the current latest release, and `ghcr.io/pelican-dev/panel:main` is built automatically from the current `main` branch. Deploying the panel in Docker is still a work in progress. While the plan is to make Docker the preferred installation method, we currently recommend the [standard deployment instructions](/docs/panel/getting-started)

This guide requires the Docker Engine and Docker CLI. (Docker Compose has been included in the Docker CLI since v2. Docker Compose v1 is unsupported.) If you need to install them, follow the [official install instructions](https://docs.docker.com/compose/install/).

## Basics
The easiest deployment method is using the standard compose.yml file.

This configuration includes an integrated web server that will automatically obtain SSL certificates if you are serving over HTTPS. For the database, it assumes you want to use SQLite (or you have an external database server to configure using the  installer.) It also assumes you intend to use the Filesystem driver for cache, filesystem or database driver for session, and database driver for queue (or you have an external Redis server to configure using the installer.) If you want to use other options built into Docker, see [Advanced Options](#advanced-options).

### Create compose.yml
```sh
mkdir -p pelican/panel
cd pelican/panel
nano compose.yml
```

Now, paste the following into the compose.yml file:

```yml
services:
  panel:
    image: ghcr.io/pelican-dev/panel:latest
    restart: always
    networks:
      - default
    ports:
      - "80:80"
      - "443:443"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - pelican-data:/pelican-data
      - pelican-logs:/var/www/html/storage/logs
    environment:
      XDG_DATA_HOME: /pelican-data
      APP_URL: "http://localhost"
      ADMIN_EMAIL: "USEYOUROWNEMAILHERE@example.com"

volumes:
  pelican-data:
  pelican-logs:

networks:
  default:
    ipam:
      config:
        - subnet: 172.20.0.0/16
```

### Set Required Environment Variables
1. Set `APP_URL` to the base URL your server will be reachable on, including the protocol (https:// or http://) and port. 
    - Note that Caddy, the integrated webserver, will serve a 308 redirect to any requests on port 80 if the `APP_URL` begins with https://. If your final site will be reachable over HTTPS but SSL will be handled and terminated by an upstream server, such as a reverse proxy, you will need to use a [custom caddyfile](#custom-caddyfile).
2. Set the `ADMIN_EMAIL` to your email address. Caddy will use this email address to generate a LetsEncrypt SSL certificate if you are serving using HTTPS.

Now, close and save changes to `compose.yml` by pressing `ctrl`+`x` then `enter`. 

### Start The Panel
From the directory in which the Caddyfile is located, run:

```sh
docker compose up -d
```

### Back Up Your Encryption Key
The first time the container starts, it will generate an `APP_KEY` which is used as an encryption key. This will be saved automatically, but you should save a copy in a secure place in case you need it later.

Run:

```sh
docker compose logs panel | grep 'Generated app key:'
```

### Install
Open the installer in your browser at `APP_URL/installer` to finish setting up the panel.

:::note
The first time the container starts after installing or updating, it will apply database migrations. This process may take several minutes, during which the panel will not be accessible.
:::

If you don't have an external database you want to use, select SQLite with the default location for your database. If you don't have an external redis server, select Filesystem for Cache Drvier, Filesystem or Database for Session Driver, and Database for Queue Driver. 

For other configuration, such as UI options, CAPTCHA, email, backups and OAuth, head to the settings menu in the admin panel.

### Stopping the Panel
The panel will automatically restart if the container crashes or the host restarts.  If you need to non-destructively stop the panel for any reason, navigate back to the directory containing `compose.yml` and run:

```sh
docker compose down
```

### Uninstalling
To uninstall the panel, navigate to the directory containing `compose.yml` and run:

```sh
docker compose down -v
```

:::danger
    **This will permanently delete the panel and all associated data** including the SQLite database and your encryption key.
:::

## Advanced Options
### Redis
You can deploy a Redis container in the same `compose.yml` file for easy setup. This example starts a Redis container and auto-populates the Redis configuration, cache, session and queue options in the web installer to use it.

Once you use the web installer, changes to the highlighted environment variables will not apply, and those lines can be deleted from the `compose.yml` file. See [Configuring with Environment Variables](#configuring-with-environment-variables).


```yml
services:
  redis:
    image: redis:latest
    restart: always
    networks:
      - default

  panel:
    image: ghcr.io/pelican-dev/panel:latest
    depends_on:
      - redis
    restart: always
    networks:
      - default
    ports:
      - "80:80"
      - "443:443"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - pelican-data:/pelican-data
      - pelican-logs:/var/www/html/storage/logs
    environment:
      XDG_DATA_HOME: /pelican-data
      # highlight-start
      CACHE_STORE: redis
      SESSION_DRIVER: redis
      QUEUE_CONNECTION: redis
      REDIS_HOST: redis
      REDIS_PORT: 6379
      # highlight-end
      APP_URL: "http://localhost"
      ADMIN_EMAIL: "USEYOUROWNEMAILHERE@example.com"

volumes:
  pelican-data:
  pelican-logs:

networks:
  default:
    ipam:
      config:
        - subnet: 172.20.0.0/16
```

### MySQL
Deploying the panel in Docker is still a work in progress, and the default Docker image does not currently support using MySQL databases. Instructions for using MySQL will be added here once it is supported.

### Custom Caddyfile
The default Caddyfile will work for standard installations. If you need to edit the configuration of the integrated webserver, such as to place it behind a reverse proxy that terminates TLS, you can do so by bind-mounting a Caddyfile on the host to `/etc/caddy/Caddyfile` inside the container.

This example assumes there is a Caddyfile in the same directory as the `compose.yml` file. 

```yml
services:
  panel:
    image: ghcr.io/pelican-dev/panel:latest
    restart: always
    networks:
      - default
    ports:
      - "80:80"
      - "443:443"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - pelican-data:/pelican-data
      - pelican-logs:/var/www/html/storage/logs
      - ./Caddyfile:/etc/caddy/Caddyfile
    environment:
      XDG_DATA_HOME: /pelican-data
      APP_URL: "http://localhost"
      ADMIN_EMAIL: "USEYOUROWNEMAILHERE@example.com"

volumes:
  pelican-data:
  pelican-logs:

networks:
  default:
    ipam:
      config:
        - subnet: 172.20.0.0/16
```

### Configuring with Environment Variables
Every setting from the installer and settings menu can be set with environment variables instead. This may be useful if you are automatically setting up your panel or setting up a testing/staging environment. See [Environment Configuration](/docs/panel/advanced/environment) for a list of options.

Note that changes made using artisan, the web installer, or the settings menu are saved to the `.env` file in the `pelican-data` volume, which will override any environment variables set using Docker at runtime. For this reason, configuring using environment variables set by Docker is unsupported.

If you do set environment variables using Docker, you should do so exclusively. In other words, if you set options using environment variables, do not use the settings menu or web installer at all. Be sure to set `APP_INSTALLED` to disable the installer. You may even want to use a [custom Caddyfile](#custom-caddyfile) to disable the `/admin/settings` page. 

## Troubleshooting
